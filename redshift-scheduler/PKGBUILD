# Maintainer: Slavi Pantaleev <s.pantaleev at gmail.com>

pkgname=redshift-scheduler
pkgver=1.0.1
pkgrel=2
pkgdesc="Rule-based screen temperature changer (like redshift)"
arch=('any')
url="https://github.com/spantaleev/redshift-scheduler"
license=('GPL3')
depends=('redshift' 'glib2>=2.34' 'libgee')
makedepends=('git' 'vala')

git_location="git://github.com/spantaleev/redshift-scheduler.git"
git_branch=$pkgver

build() {
	cd "$srcdir"
	msg "Connecting to GIT server...."

	if [ -d $pkgname ] ; then
		cd $pkgname
		# Switch back to master as we're now on a tagged branch
		git checkout master
		git pull origin
		msg "The local files are updated."
		git checkout $git_branch
	else
		git clone $git_location $pkgname
		cd $pkgname
		git checkout $git_branch
	fi

	msg "GIT checkout done"
}

package() {
	cd "$srcdir/$pkgname"

	/bin/bash build.sh

	install -Dm 644 $srcdir/$pkgname/resources/rules.conf.dist $pkgdir/usr/share/redshift-scheduler/rules.conf.dist
	install -Dm 755 $srcdir/$pkgname/build/redshift-scheduler $pkgdir/usr/bin/redshift-scheduler
}
