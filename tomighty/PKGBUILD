# Maintainer: Slavi Pantaleev <s.pantaleev at gmail.com>

pkgname=tomighty
pkgver=0.7.1
pkgrel=1
pkgdesc='Desktop timer for Pomodoro Technique users'
arch=('any')
url="http://www.tomighty.org/"
license=('Apache')
depends=('java-runtime')
makedepends=('git' 'maven' 'java-environment' 'imagemagick')
source=('tomighty' 'tomighty.desktop')
md5sums=('941bdeb609169335cea3e9cf40904883'
         '66425a9e185788f720b466ca1caf5769')

git_location="git://github.com/ccidral/tomighty.git"
git_branch="master"

build() {
	cd "$srcdir"
	msg "Connecting to GIT server...."

	if [ -d $pkgname-git ] ; then
		cd $pkgname-git
		git checkout $git_branch
		git pull origin
		msg "The local files are updated."
	else
		git clone $git_location $pkgname-git
		cd $pkgname-git
		git checkout $git_branch
	fi

	msg "GIT checkout done"

	/opt/maven/bin/mvn clean package
}

package() {
	# This extracts several different sizes as {tomato}-{number}.png
	# tomato-0.png is the largest and the one we want
	convert $srcdir/$pkgname-git/img/tomato.ico $srcdir/$pkgname-git/img/tomato.png
	install -Dm 644 $srcdir/$pkgname-git/img/tomato-0.png $pkgdir/usr/share/pixmaps/$pkgname.png

	install -Dm 644 $srcdir/$pkgname-git/target/$pkgname-$pkgver.jar $pkgdir/usr/share/java/$pkgname/$pkgname.jar
	install -Dm 644 $pkgname.desktop $pkgdir/usr/share/applications/$pkgname.desktop

	install -Dm 755 $pkgname $pkgdir/usr/bin/$pkgname
}
